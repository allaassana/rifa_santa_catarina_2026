<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Painel Admin â€“ Rifa Santa Catarina</title>

<link rel="stylesheet" href="css/style.css">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const supabase = supabase.createClient(
    "https://ydyuxumwqnuhomahaxet.supabase.co",
    "SUA_SECRET_KEY_AQUI"
  );
</script>
</head>

<body>
<h1>ğŸ›ï¸ Painel Admin â€“ Rifa Santa Catarina</h1>

<table border="1" cellpadding="8" cellspacing="0" width="100%">
  <thead>
    <tr>
      <th>Bilhete</th>
      <th>Nome</th>
      <th>Telefone</th>
      <th>Email</th>
      <th>Cidade</th>
      <th>PaÃ­s</th>
      <th>Status</th>
      <th>Comprovativo</th>
      <th>AÃ§Ãµes</th>
    </tr>
  </thead>
  <tbody id="lista"></tbody>
</table>

<script>
async function carregarCompras() {
  const { data, error } = await supabase
    .from("compras")
    .select("*")
    .order("bilhete", { ascending: true });

  if (error) {
    alert("Erro ao carregar compras");
    console.error(error);
    return;
  }

  const tbody = document.getElementById("lista");
  tbody.innerHTML = "";

  data.forEach(c => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${c.bilhete}</td>
      <td>${c.nome}</td>
      <td>${c.telefone}</td>
      <td>${c.email}</td>
      <td>${c.cidade}</td>
      <td>${c.pais}</td>
      <td><strong>${c.status}</strong></td>
      <td>
        <a href="${c.comprovativo_url}" target="_blank">ğŸ“„ Ver</a>
      </td>
      <td>
        <button onclick="atualizar('${c.id}','confirmado')">âœ…</button>
        <button onclick="atualizar('${c.id}','rejeitado')">âŒ</button>
      </td>
    `;

    tbody.appendChild(tr);
  });
}

async function atualizar(id, status) {
  const { error } = await supabase
    .from("compras")
    .update({ status })
    .eq("id", id);

  if (error) {
    alert("Erro ao atualizar");
    console.error(error);
  } else {
    carregarCompras();
  }
}

carregarCompras();
</script>

</body>
</html>
